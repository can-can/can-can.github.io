<!DOCTYPE html>
<html>
    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Tips for Mybatis</title>
  <meta name="description" content="1. Mapper can not have two methods with same name, while using annotation to impelment MapperExmaple">
  <link href='https://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic|Source+Sans+Pro:400,700,200,300|Josefin+Sans:400,600,700,300' rel='stylesheet' type='text/css'>
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">

  <link rel="stylesheet" href="/css/style.css">
  <link rel="canonical" href="http://localhost:4000/en/2017/07/16/tips-for-mybatis.html">
  <link rel="alternate" type="application/rss+xml" title="Optional<String>" href="http://localhost:4000/feed.xml">
</head>


    <body>

        <div class="wrapper">
    <div class="trigger site-navigation">
        <a class="page-link" href="http://localhost:4000/en">HOME</a>

        
        <a class="site-language" href="/zh/2017/07/16/tips-for-mybatis.html">中文</a>
        
        

        
        
        
        
        
        
        
        
        
    </div>
</div>

        <div class="page-content">
            <div class="wrapper">

                <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

                    <header class="post-header">
                        <h1 class="post-title" itemprop="name headline"><a class="post-title-link"  href="/en/2017/07/16/tips-for-mybatis.html">Tips for Mybatis</a></h1>
                        <center>
                            <p class="post-meta">
                            <time datetime="2017-07-16T00:00:00+08:00" itemprop="datePublished">
                                

                                
                                Jul 16, 2017
                                
                            </time>
                            </p>
                            
                        </center>
                    </header>

                    

                    
                    <div class="post-content" itemprop="articleBody">
                    

                        <h2 id="1-mapper-can-not-have-two-methods-with-same-name-while-using-annotation-to-impelment-mapper">1. Mapper can not have two methods with same name, while using annotation to impelment Mapper</h2>
<h3 id="exmaple">Exmaple</h3>

<p>The code below shows two methods with same name, using Java’s overload, and can be compiled correctly.</p>
<div class="highlighter-rouge"><pre class="highlight"><code>public interface TestDAO {
    @Select("SELECT COUNT(id) FROM table WHERE id = #{id}")
    int select(@Param("id") int id);

    @Delete("SELECT COUNT(id) FROM table WHERE id = #{id} AND id2 = #{id2}")
    int select(@Param("id") int id, @Param("id2") int id2);
}

</code></pre>
</div>

<p>But, when we run the code, This exception will be raised.</p>
<div class="highlighter-rouge"><pre class="highlight"><code>Exception in thread "main" java.lang.IllegalArgumentException: Mapped Statements collection already contains value for dao.TestDAO.select
    at org.apache.ibatis.session.Configuration$StrictMap.put(Configuration.java:859)
    at org.apache.ibatis.session.Configuration$StrictMap.put(Configuration.java:831)
    at org.apache.ibatis.session.Configuration.addMappedStatement(Configuration.java:655)
    at org.apache.ibatis.builder.MapperBuilderAssistant.addMappedStatement(MapperBuilderAssistant.java:302)
    at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.parseStatement(MapperAnnotationBuilder.java:351)
    at org.apache.ibatis.builder.annotation.MapperAnnotationBuilder.parse(MapperAnnotationBuilder.java:134)
    at org.apache.ibatis.binding.MapperRegistry.addMapper(MapperRegistry.java:72)
    at org.apache.ibatis.session.Configuration.addMapper(Configuration.java:728)
</code></pre>
</div>

<p>Why dose this exception be raised? Let us look source code. The code below is at <code class="highlighter-rouge">Configuration.java:655</code>. I find that Myatis put <code class="highlighter-rouge">ms.getId()</code> as key into StrictMap，causing the exception above.</p>
<div class="highlighter-rouge"><pre class="highlight"><code>//at org.apache.ibatis.session.Configuration.addMappedStatement(Configuration.java:655)
public void addMappedStatement(MappedStatement ms) {
    mappedStatements.put(ms.getId(), ms);
}
</code></pre>
</div>

<p>Further, I dig source code and find two codes will generate the id of MappedStatement;
First one is at <code class="highlighter-rouge">XMLStatementBuilder:57</code>, <code class="highlighter-rouge">String id = context.getStringAttribute("id");</code>. This code show us that the id is excract from attribute named id in XML.
Second one is at <code class="highlighter-rouge">MapperAnnotationBuilder:292</code>, ` final String mappedStatementId = type.getName() + “.” + method.getName();`. When generate Mapper by annotation, Mybatis generate id by adding class name and method name and no argument, so there will be raised exception when method name is duplicated</p>

                    </div>
                </article>
            </div>
        </div>
    </body>
</html>
